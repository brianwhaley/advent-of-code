var inputs = 
`nenwnwnwnwnewnwsenwnwnwsenwnwsenwnenww
eeeeeenewsweneeeeseeenwwnene
seeesesesenweeseewnw
nesesweneewseeseeseenwweeswesw
neeneeswneeeeeeeneeneeneweee
seseesenwsesesesesesesesenewseeseswsese
senwwwenwneswnwnwewswsewnesewesw
swswswswswnwseswwswswswswswswswsweswnw
neeneeweeeeseeneneeseeneneenenwe
seneswwnenewsewesenenenenenenenwnenenene
wwnwnenwsenwwnwwwwwwwwwwnww
seeeeneenesewseeswneeewnwseseswse
nwwwsenwnwwwwewwwwewnwwwwswnw
neneswenenenenenesweneneenewnwenenewne
nwwwneseswswnwesenwnesewswwsenwseww
nwwwnwnwnwnwnwwnwnwsewnwnwnw
nwsewsenenenwnweswnwnenwenenwswnwnwnwnw
nwnenwneewnwneswwnwnenwnwnwnwnwnwnwese
nenwneneenwnewnwnwnenw
seswswseswwseneswswsenwseswseswswe
swseswwswswswswswnwswswswswwnwseswswsww
wswseswswseswswsweswswneeseswwnwswnesw
nenenenwnwnwnenwnesenwnwnwnwnewnenenwnw
seneswnenwnenwnenewneseenwneneswnwnenenwne
nwnwnwnwnwnwnwswnwnwenwnwnwnwnwnwnwnww
nwweenweswneneneneneneeseeesewnene
nwswswswswswsweswswseswswswswswswswswsw
eeeenwneneeswneeeeneneneneeeneew
swwsewwwnwswnwwenewswswwseswswnesw
eswseswneneseswswwsenwseswswsesw
wewnewwwswswewsewneswswswswwwsw
eneeneeneneeneweenewneneeenenesw
enweneeesesesesesewneswneswesesewse
nwswswswwwswwswswwwswwswswswewsw
eeseweseseswseneseeseseeseseesee
nwswswswswswswswswnenewwswswwsenweswsw
wwwnwsesewnenewswsenenewww
neneneneneneneneeswnenwneneneswnwnwnenwnw
nenwnenwnwneswswswsewnenwnwneeswswnww
ewswswnewnwswwswswswswnesweswnwsesesw
nweenwnwnwswwnwnwnwnwwswnwnwnwenwswnwnw
senenwneneneeswneeeswnewenwnewswne
swsesweswnwwswswswswsweseseseswswwsene
swswweswnwwswnwwnwswwseewwwwsw
ewenwswwwwwwwwnwsewnwnenwsenww
eneenesenwswnenwnwnwneneneseseeswenwsw
sesesesenewnwnewsewseesewseseseesene
neeweneseeeeeswenweeneeswee
nwseseeeseeeeeseseewseweesenwe
eenweeneneeeeneseee
nwnwnwnwnwswnwnwnwnenwenwnwnwnwnwwswnw
sesenenwweseseeseesweeeneeseeese
nwenenenwnenwnenwnwsenwwnwsenwneseswsw
enwneneenwseswwneswwnwneswneseswwe
swswswswswwswseeswswswwneseseswswsese
nwnwnwenwneswnwnenenwwnwnwnwnenwnwnwne
nwwnenwewswswswswewswsweswenwswnwsw
nwwnesweswwswswwwwwewwwswwsww
sweeseeeeeeeenweeeeenwesw
wsewnewwwwnwwwwswwwwnew
wewwwswnewsesenewswswwwwwww
eeewneneeeeeeeseswesweseesee
nwwnwnenwneneswseneswsenwsenewenesenene
nwnwnwnwsenwnenewnwnwnwnenwnwnwsenenwnene
swswswswenwswseseeswnwswnwne
wesenwnwneenwnwnwnwnwnwswnwwnwnwnwsww
eeeweeeneenwneeesweseeeeee
neeswneswnewswswswnenenenwnenenwnenenenw
nwnwnenwnwnenwnenwwenwnwswwnwnwnwsenwe
wwwnwwwwwwwewwewwnwwwwnw
wnweswswwwwnwnwnwwnwnwwnewswnenwnw
nwsenwnwenwsewnwnwnenwnewnwenewnenwswnw
swnwsewweseswwsesesewnenesenesenesw
swwswswswsweswswswswswswswsw
nenewswneswneneneneneneneseneswnenenene
eswnwswswseswswswnwseswseeswseswseswsesew
newnewneneseeweeee
senwwseeseswseseseeseswswswswseswseswse
wsenenewneneweneeneseneneneeneenee
eneseseswsesewswseseseseew
wweneswwswswwwsewwswswwnwswwwsw
eeseeeewsweweseeeeenwewe
nwnewnwnwewswenenwnenwenwswnwneswnw
nenwseswnesesesweseseseswenwseewsesee
nwnewwseswwsenwnwneewnesenenwesenw
wnenenwnewneseneneneswswnesenwnwneenenene
esesesenwswseseseeeseeswsenwe
swswswswswswwswneswswwswwswswsww
neswsweswneneeeswwswwnwenwseswnenenene
nwswnenenenenwnenenwneneneneneswneenwnw
eesenweneeseseeeeswseeweesenw
swneneswnwenenwnwsenwnwnwnwnenwnwnwenw
nwnwsenwwnwnwsenwnewwwnwnwnwnwnw
nwseseneeewsenwnenenwneseswsweseswesw
nwnwnesenwnwnwwnwnwnwswnwnwnwnenwnenwne
eswswnewseswsenweswswswnesenewswswsw
eeneswneeeweneseswenenwnee
nenenwneseswwnwneneewnwenwswwswese
sewwwnwwwwwenwswwwwwwwwnw
eeewnweeneseeesweeeeweewswe
newsewswneeseswseseeseeseenesenwe
nwnwnwenwswneswsenwnwnwwnwnenenwswnwnwe
swnwswswswneswsesweswsewswseswswswseswnwsw
nwwwnwwsewwnweneswwwnwwewwww
wwswnwwwewnwwwsewnwnenwnwwwww
swswsweswswswswswneswneswswseswsesew
seeeeeeeeeeeeeeeenwswee
swseswseneswswswwswswswsesesesewneswsw
sesenwwnwseewnenwsee
seseeseseeseseeswseeesesesenwwsee
wseswsenenesweenwwswwnwwswnwnwenw
eneeeeeewenwweseseseeeneswese
swswseswseseswwseneseswswsweswsesesw
enwswsenwwnwnwnwsewwnwwewwnwnwwsw
nenwnwneneswnwnwwnwnwsenwwnwnenwsenwne
eseseeeneneeeeeeweeewesesew
seseswseeseswnwseswsesenwswseswnwseesenese
swswwsenwnewswsewsewsenwswwwnenenwse
nwswwswswwwswswswswswswswswseswnwesw
swwnwnwwnwsenwnenwenwwwnwnwnwnwnenwnww
neeneneneswnwneneenenenenwnenenwneneneswne
swneeswnenenenenenwnwswswnwewsenenene
seweweswseswswnenewnewswswnewenwne
wsewwwweswwnewwwsewswnewwew
newnwnwnwnwnwnwnwnwnwnwnwnwnwnwenw
swsenwswseseseseswnwswswswswsweswsesesese
nwnwnwwnwwwwnwwnwwwwse
nwnenwenenenwwnwnwnwnenenenenwnewene
sweseswnwnwswwsweswswswseseswswnwswsene
swwnewnweswewweneswesewenwswsw
nweeneswnwswswsesesesewwe
weswwnwswswsenwsewwswneswwswwww
nwnwnwneswnwnwnwnwnw
swswswswswswswswenwswswswswswnewswswswsw
nwnenwnwnwswswneneswsenwnwnenwnwnwswnenwnw
seseeseseswsenwseeseseneseseseseenwse
neenwnwnwwnwnwswnwnw
sesesewsesesesesesesesenesesewsesene
eeeneeeneneeenesweeenweeenesw
swsesesesenwswesweseswnwswsenwswseswsw
eseseseswseeeeswneesesesenweseeewe
neseeeeenweeeeneeeeneeneesenw
seeseseseseseseswswsenwsesewsesesesese
wswewwwwwewwswswwwwwwww
nwnwnwnwnwneenwnwnwsenenwnwnwsenwwnwnw
wwsewwwwwwnewnwwwwnwnwwwnw
swswseswswswswswsweswswswswwsweswswswnw
nenwnwnenwnenwnwneswnwnenwnwnwnwsenenesw
eweeseesweeeenwnwseswneeswnwenw
nenenewnenwnenwesenenenenenwne
nwenwsesenwseneeseneesenwseswwswsww
swswsenwnenwswswswseswwenenenwswswsese
wnewsewwnwwwwwwwwwnww
nwnenwnwnenenwnwnwnwnwnenwnwnwsenwnwnww
wwwneswwsenwwsenwwweewnwwnwnwe
wnewsewwnwwwswwenenwwnwsew
nwseswwsenwnwswnwneenewweneswwswne
weweeseseweswnwene
nwnwsewnwwnwnwwwwnwnwnwnwnwnwnw
enwseseswswswswswneswwswneswnewswswwsw
seswwenwnwwwwwsenwwwwnwswnewnwwnw
wnwwnwwwsenewnenwnwswwwwwnwwnwnw
neneneenewneenenesewneeeneneeene
wneswnwwwwwswwwwwseeseewwsw
neswnenenenwneneneenenenenwnwnwnenenene
nwnwnwnwsenwswnwnwnwnwnwnwnwnwnwenwnwnw
nenwseseneweseneneswwwseswsewswsesese
esesweseeeseeseseeeseeenwseese
sweneseswseseseseeseneseseesesesesee
nwnwnwswneneneneenwnenwnenenwnwnenw
nwwwswewsesewneww
wwwwwnewswwwswwwwwewwwwsw
sewwwneswswwsewnwnwwewwwwwe
nwnwnwnwnwnwnwnwnenwenwswnwnwnwnwnwnwnw
swswswswwswswnwswswwwswswswseswneswse
senewseseseswsewneswseweseseesesene
swseswswswneeswswswswseswswnwswswwswsw
nwesweenewsweneeneenesewneseee
eswseseseesenwseeenwnwseeseseesee
nwnewsenwwwwwwnewwwsenwnwnwww
eneneneneweneewenenene
senwnwnwnwnwnwnwnwnww
eneeeeneneeeeeeseeneeenewne
eseswswswswnwswswswswnwswseneswswswsww
nwwnwwnwnwnwnwnwsenwwenwnwnwnwsenwnw
wswsweswswswswwswswwwsenewswswwsww
enenewneneeeenenewsenewsenenene
eseeeeeseeeseeeesenwsweeese
eneeswwsewneseeeneseseeneewwee
swseseneswnwswswwswswswswswseswsweswswsese
neesewesesenwewneeeeneeneeeenwsw
eswwseenweseenweeeseeeeseee
wswseswneseneeswwnwsewse
sweswswswwseneswswneswewnwswneseseswsw
sesenwseseeseseseeenwseseeswnwsesee
seseswnwswseswswswswneseseswswseseswswsesw
nenweswwseeneeneneenenenesenenenenwnene
nwnwnwnwnwnwnwnwnwnwnwnwenwnwnwnwnwnwsw
swswwwwwswwneseswswwswwwwwswew
nwnenwnwnwwsenenwsenwwnwnenwenwnenwnwnwnw
wsewnwnwnenwnwnwnwnwnwsenwnwnwnwnwnenw
nenenenenwneeeeeeneeneeneeneseswe
wnenenenwnewnwnenenwnenenwseenenesenwne
nesenwsewnenwswenwneesewswnwswnesww
wwnwenwewswswwnwwseswnesweswnww
neneneenwneeneneneneswnenwneneneswneswne
nwnwswnwenwnwwewnwnweswnwnwwwnwwsww
eeeeeweeeneeeseseseeeesee
wwwwwswnewwwneswsewwwwwww
nweeswwseeseeenweeeeenene
nwnwnwnenenwnwnwnwsenwnwnwnwnww
seweeeseseseseeseeseeeeewesese
wseewseneseeseseesesese
senenwnwswnwnwswnenwnwnweswwwnwnwnene
swseseseesesesesewseseseenesesesewsese
seswswewseswswneswse
nenwnwnwnwnwnwenwnenenwswnenwnwswnwnwnwnw
neneeswwswnenwnwenwnenewnwnwnwnesewe
wnwnwswwnweeenenwsenwseenwnwwswnw
eeseseseeeeeeseeseneesewswnwse
neswseswewswsweswwswseswswwswswnwesw
nwwnwewsewnesewnwwsewww
weseeneneneeenesenweesenwwenenenee
nwwnwwenwnwnwswwwnwwnwnewnwnwswnww
nwwnwnwnwnwnwenwnwsenwnenwwnwnwnw
wsewseesenwneswnenenwenesewwwsww
swsesesesesesesenwwnese
newswewenenesewsenwweesweseenenw
nwnwnwnwnwnwnwnwsenwnwnwnwnwnw
swsweeswswseeneswswswnwwwswwnenwswsww
neneeneswneneneewnesenenenesenwnenw
nwnesenwnwnwnwnwnenwnwnw
nwnwswnwwwsewnwnwwsenenwwnenwnwswnwne
nwenwseseseeeeswsesesesesenwseweese
nwnwnwnwnwnwsenwnwwnwnwnwwnwnwnwnwnw
seneweseseseswnwswesesewseneseseswnew
eeeseseeeeeeseeseswnweeene
swnwseeeswnwseeseeseseesenw
swswswswsesweseswswseseswswseswswswnwsenew
swseseseswneneswswseswewsesweswswswnw
ewwswnewwwwnwswnwwwenwwwww
newneneeneseswwwseswwnenweenwseene
nwseswsesweseswswseswswnwnwswswseeseswsw
eeneeswneneeneseeeweenenenwnee
wsesesewswseeseseseseswseseswsesesenwne
swswnewewswsewnewwwnewwnwwnwew
swseswswneswwnwswneeww
sweswneeeeewneseenwneew
nwnwnwwwenesenwnwwnwnwswsenwenwswnwe
nwneenenwwsenenenenenwswsenenwneswnwnenew
wwwwsewswwwwnewwwwwwwnwww
wneneneeneseneeeeeneneneneneneene
seseeseeseeeseeesweseeesewnwew
seseeeswnwseeseseewseseeseseseeseese
seswsesesesenwsenwseseseswsesesesesesesese
swsweswswswswswnwswswswswswswneswswswsw
eeeeeweseeee
eewseseeeseeeseseeswsenesesesesenw
sewsewneseswseseweseneseeenwsewnwse
wnwwwwnwnenwwnwnwnwnwwswwnwwewnw
eeseseeewsesweeseneneseeeseee
neneseswseeeewneeeeseseswwseswee
neneeswenenweeneneenenenesewneeneene
swnwnenewwswseswwswsw
seseseswsesesesesesesesesenewwsenesese
nenesenesewesewsewneswseswneneswswse
neswswswswswswswneswseswwseswsenwneseswsw
neeeneeneneneneswnenwswneneneswnwenene
wwwwswwwnewwwswnwnwswseswwwesw
swneenwneeneewnenenenenewneswnenene
swswseseswswswseseneeswnwsesenwswswsese
senesenwsenenewnenwenwsenenwswenwnwwne
seseenwseenwseswseesesesesesesesesese
senwnwswnwnwswnwnenwwseeneneeswswnwnwne
nwwwnwnwwnwnwwewesewnwwwwwnw
enwnenweeseswnweewseneesweneeene
swswseseswsenwseseseeeswseseswswswnwsewse
nwwnwnwnenwseseswnwnwswnwne
senewseseseseeseseseseseeseeseseese
swswnwnwnwnenwnwnwnenwnwnwnenwwnenwsenwnwnw
neeneeneweeneeenweneseeeseswne
senenwnwnwnwnwnenenenesw
swswswwswneswnenwsesesweneswwswswswnew
nesewseeeseseseseesesee
eeeswnweweeeneeneneneeneeneee
senenenwnwnwswnwenenenwnwnenwnenene
senwnwnwnwwnwnwnwnwnwnwnwsewnwnwwnwnwnw
seseswseseseswseswwwseseseswsesweneswsese
eswnwsenwswswnwenenesesewwswnwnewe
eneneeseneeeeeeeseweeneneswenwnw
swwnwwswswnwswwseweswswweeswswsw
wswnwnewnwswweewsewnewnwnwseswsese
wwswwwswwswswnewswwnewswswswseswsww
sesesenesesesenwsewseseseseseewesesese
swneseswseswseswswswswswwswseseenewsese
ewswneseneswnwsesenwsewwnwenesewnew
eswnenwswnesweenwnwnwnwnenewneswsene
neweeeeneseeeeeeenewnenene
seseseseseeseseseseseseseesesesewwsene
swswswswswswswswswswswswswwswswswswewne
neenenewnwnenenenesenwneneswnwnee
nwewnwewsewswenewwseswswnwneneswne
swswseswneneseeswswseswseneseseswsewnw
wneneneenenenwnenwwnenenenenwneneene
weswnwnenwwsewswwwne
nwnenwnwnwnwswnwnwenwnweswnwnwsenwnwnwswnw
wnwwsenwswwnwnwnwenwwswnwwnwsenwwnwe
nwseeseswswseswseseswnewwseneseswseswsene
wwnwnenwwwswnwwwwweswnwwwwese
swseswswswswweneswswnenwseswneswnwswsw
ewswneeeseesewseeeseseeenewe
seswneseseswwswseseseseswseseswseseswsw
neneweneeeeesweneeenee
seeeseneweswnwwenweneenenwnesesw
eeeeeeeewesesesesesesesesesewse
newwenesesewseseseseswseswsesesesesese
eeseeseeweeneewseeeeeeeeee
swswwswwswswwswwwseweneneswswsesww
eeeweeeeseeeeeeeenweswe
wnwwwnwenwwwneseeseenwwnw
eewewesweneenenweewsweseweene
enwseswswnweswwswseneeenenewsenese
sweseswneseswswswswswswseswseeseswswnwswnw
eneswswnewwnwnwwnwsenwwee
swwwnwnwwnwwsewsewnwnwnewwnwenw
wenenwnenenwnenwneneneneneenenwwnwne
wnewwnwwsenwwnwwnwnwswnwwnwnwwwnw
wnwwwwwseeeneswnwnwnenesenwswsewsew
neneneneswnenenenenenenwnwnenesenenenenwne
nwwwwwwwswwwenww
nwseswwswnenenesenewesenw
swnwnwnwesweneseswnenenwnwnenenenenenw
eswwswswswwneswswwswwwewneswwswse
swneeseswnwswseswnwseseweeseenwswsew
wnwnenenenenwsenenenenenenenwnenene
neneseneeneneneneneneneneneeneenwswene
eenwenesenewsenenwneswewsw
swseseswseseeswneseswswswswswsesesenwsw
neeeneneneneneneneneneneneswnenenenewne
wnwnwnwwwswnwwnwnwwwnwnwnwnwnwenenw
neeswneewseeneeneneneneneneneneeeene
wswwwsewwwwwwwwwnwwweww
seseseswenwnwseesesesewseswnwsesesese
newneseeeseneneseswseewswenwseeese
wnwwwwnwwwenwnwswnwwnwwwswneww
nwneeeeeesenenweeeeeseeneesewe
nwnwnwnwnwnwenwwnwnwnwnwsenwnwnwnwnww
eseesewsewneeseneswneseneseesew
wseswenwnenewnwwswwewsesewwwsee
wsweseswsenwnwnwesesewseneseseseseese
wseswswseneneewswseseseseseswswsesese
swseswneswseseswseeswseswwswwswewswne
esweeeneeeeeseneeeeenwwee
wswswewnwswswswswnwswswswswe
nwweneswewwneneeeeneeweeeeee
sesesesenweswseseenwseseeeswsenwsese
neesewsenenweswsw
wswwswwseswweswswwwwnewwwwsww
swneswswswswswswswswnewswswseswswswswswsw
eweswnwnwwewswwswswswwswwswnwwswsw
nwsesesesweseseseseseseenwewnesenwsesesw
wwswswswewweswswswwwenewswwsww
seeeeweeeeeesweseeneeeee
esweeeseseeeseweseneseeeeese
wwswweswwwswswswwswwwwswww
neswseneseewnweenwnenenwneseswenwenwse
esenweeeseeeeswnwesweenwsenwe
swnwsenwnwnwnwnenwnwenwsenwwnenenw
swnwsenwnwsewsenwnenwnwnwnwe
neneweesweneneewenenewwsesew
nwnwwnwnwnwnwwnwwwewswnwnwnwnw
nwwnwwswwwnwenwwwnwnwwenwnwwnwnwnw
wseseswneeneweseseswswswsenwnwsesew
wwswswwwwswswwwnwswewswwwwne
eeeeeeeeesweeenweee
ewnwnwnwnwwnwnwseswnwnwnwenwsenwnwnw
nwnenweswnenwnwswenenwswnwesenwnesw
nwwnwwnwnesesenwsenwnwnwneenwenwswnw
senwneneweswenwswnwnwwwnwwsenwnwne
eseeswseeeenwsenwe
sewsesweseseeesenweseeneseseseseese
nenwnenesesenwneneesweneeenewnenee
seswswswswwwswwwnewwswwwwwww
swswwswnwswswneswwwswewswswswsewsw
nwwwswnwenwswnwsenwnwwwwewnwseneene
swwwneswnwewnwwwseswwwseswwsw
nwwenwnwnwsewnwwwnwnewnwwwwnwnwew
nwsenwsenewenwnwnewnwnwsenwswnwnwnwwnw
seswseseseswseswseseseeseesesesenwsewsenw
neswnwswnwewswswswwewnewwesweww
nwnenwnenwnenwnwnwnenwsenenwsenwnwnwnenwne
seswswwwnwwswwwswwnwswnewwwewww
nenenenenenenenenenenenwswnenenenenenenesew
neswswswswswswswswswswswswswenwswswswsw
sesweeeneeseesweeneeeeee
nwwswwswswwneenwswwneswnwswswswee
sewseesesenwseseseseesesesesesw
neenenesweweenweeeneneneswe
nwwwwneswwwwwsewwnenwswwnewwnw
eeeswnenweeeswswneeeneneswneene
sewnwnwseneneswneseswsesewswnwsww
enwnwswnenwswwsenwsenwnwnenwnwnwswnenwnw
neeeswneeeenwnewnweneeneneeseese
swsesewnwswnesewwwwswwwwwwneww
swswswwswswseswneswwwwswswswwsw
sewnewwwwwnewwwwwwswswwww
nenwenwnwneneswenwseseeeewneswnee
swwewnwwwnwsesenenesenwsweneswnenwnww
eeeseeneeeeeeweneeeeeene
swseseeswseswnwswsewswneseseswsesesese
nwseeweweneenweseeesweeeee
eeeeeneneneneneneeneeswwnewne
wwwwsewsweswswweswswnwwwswswswsw
nwswnwnenwwnwwnwnwnw
eeesenweeeseeeenwsweeesesese
enwnwseenwnwnwnwnwnwnwnenwnenenenwwnwsw
sewswswnewneswswneswswswseswswswswswswswsw
nwnenwnenwnwnwnenwnwnwnwnenwnwsenwnwnw
nwswswneswswwwswneeswwnenwnewwswswsese
sweswneswswwwswswswswwwswswswswswsw
wnwnwenwnewnwswwnwwswwwnwwenwese
swseneswswswswwswswswswneswswswswswswswsw
nwseeswnwnwsenwwswnwseenwnenwnwwe
wwwsewwnwwnewnwwwwwwwwww
sesweseeseeeseeseneenenwsewswsesese
wnwswnwwnwnwwnwwnwwnwnwnewswnenewsw
nenwnwnwnwnwnenwsenwnwnwnwnwnwnwnwnwnww
wnwnenwswnwwwnwwesesew
nwnenenenwnenenenwswnwnenwnenwneenwnene
eswnwwswswseseswswnwseswneswswsw
nwnwnenwwnenesenwnenenwnwneenenww
nwwwneneneenenwnwnenwneswneneneeneene
seseneneswwnwenewwswenewsenesewesww
neenewnenewneneneneseneneeeneneene
wwwwnenwwwnwwwwnwwwwsewwew
neswnwswnwseeseeswnweseneenwsesenew
nwnenwneenwnwnenwnwnenwswnwnenwnenwswnwnwe
nenewseswwwswswswswswswse
seswsenesesesewseswneswseeseseswseseswnw
wnwsewseswsewwwwnwwwwwwwenw
swwswwswswswsweeswswswswswswww
swnwnwnwnwwnwnwnwwwnwnwnwnwenwwnewsw
wweeneeeswneeeeeese
swswswswswswswwneneswswswswwswswswwswsesw
seseseneswseseseseswseswseseseseswwsenwsese
wwwewswnwwwwwnwwnwswnwne
wenwnwwwnwwwswwnwwwnewnewswsenw
swwswwwnenesewswswswnwswswsewwwwsw
nenwnewneneneseneswneneneneenwenenenene
nenenewneneneswnenenenenenenenenenesene
swnwwsewwwwwwwwswwneswwesesw
wwnwnwnwwwsewwwwwwwwwwsew
nenenesenewnenwneswnenwseeenwnenwsee
senwenenwnwnenwnwnenwnwneneneswnwnwnesene
neneenwneneneweeseswwnesenenwnwnewnesw
ewnwnenwnenwnenenwnenwsenwnwneswnwsenw
seswswsweseseneswnesesenwswnwseseswswwsese
swswnwswenenwsewsesw
sesweeseeneseseswsewesenenwnwsw
seseseswseseeswweseswseswnwsesesesesw
neeswnwswnenesesenwnwnwewsenwnwnewwsese
wneswwwwwwwswwswwswswswww
eeeeeeneneeenwswnewsweswnwnenw
neneswweeneeenwwseneswnweneenee
nenenewnwnenwnenewneneeneneneene
wswswswseswswsenenwswseswsweswsweswswnwsw
wsesesesesesesesesesesesesesesenesesese
wnwwnwwwnwswnwwsenwnwenwnewnwwnw
wwswneneesewseneswnenenenenenenenwneese
neeseswnenenwwnenenwseneneneenwneneww
enwnenwswneneneneneswenenwnenenenenenenwne
neneneneneneneenenesenenwneeneswnenenene
swsenewswsweseswswswewneewwswwnw
wsewswswnwneswwwwswswwswwwwwww
seneneneneeneneswsenenewnwnwnene
nenewnenenenwnenenwnenenwnenwnenenenese
seseseswswnenwseseseenwswnwswsesesewsese
swnwnwnewsweseeneseswneeenw
wwsenwnwnwnwewwwnwwwnwnwwwnwnw
nwwnwneseseeneswnwnwnenwnwsenwnwswse
eeseneeeseeeeseneseswweseeeswe
swswneseswseswwswswswswwswswswswswnenwsw
nwnwnwnenwwsenenenenwnwswnenwnwenwnwnwnw
eseseseeesesesesenwseseswseesenwsese
enweeseeeswenwseseeeseeeeeesw
sesenweeeeseseeeesweseeseeee
nwnwnwnwnwnwnwsenwnwnwnwnw
nenwneswnwnwnenwnwnwnenwnwnene
neseeeeswwenweeweweweenewe
neweeeseeseseseseeswenweeesenee
swwswnewseeswneneeseenwnwenwnenenenw
seswesenesewswenweseenweeweeene
seesewnwswseseesee
nwneswseseesewwnwseesenewneseswsese
nwseeeeenwesesewneseseeseeswsesee
nenenenewneseesenenweeesenenwnenenene
eeenwswwnwneenweeewsenwswesese
wneswwwwwswwwnewswswswwwswwseswsw
swseswseseswsesenwsesesenesesesweswseswse
wwswneswwsewwwweswsw
wseeseeenwseseneswswseese
nenwswnwswwwswsee
nwnwnwnenwnwnwnwnwnewnwnwnwswneenenenwne
eeeeswneseeeesesee
enenenwnwnwnwnenenenwnwnwnwswnenwnwswnw
eenewesesenenenenenewnenenenwneswnene
nwnwnwnwsenwnwesewnwsenenwwwwwnwsenwne
eesenwwsenwseswswwseweeeesenene
eeeneneeneeneeeeeneeewseesw
swwwwwswswswswwwswnwswwswwsweesw
neneneeenenewesweenwneeseeenenwee
swwswnwwswswswwswewswwwswswwww
neneneneneeewneeweneneenene
swswseswswnwswswsweseswswswwswswswswswsee
nwnwneswswswsewneswswseswnweswswweswse
eswswwswswswswswwneswswsweswsw
nwwwswswswwwsenwwwwnesewwswww
newneneeswneneneenesenenesw
nwwnwnwenwnwnwwnwww
nenesesewseseseseseseseseseseseseseesewe
neneneneneneneneneneeswneneswnenwneenene
nwswnwnwwwwnwnwnwewnwnww
nwnwnenwnwnwnwnwnenwnwsenwwnwnwnwnwswnwnw
nwnwnwnenewsenenenenwnenwewwsenenwne
wwsweswwwwswwswwswswsww
newseenewenwseswswsw
neswsenwnwnweenenwesenenwnesenenenenenesw
nwswwnwwenwnwnwnwnwenwnwswnwnwwnwwnw
nenwneswnenwswnenwnenenwnwnenenenenene
swswswswwweswswnwswseswswnewsweswswsw
ewseeseseseseeseeesenwseseseesese
nwnewnwsenwwnwwsenwnwww
nwswswswweneswswwswwneseswseswswswe
eewseweneeeseesweneesesenwneswe
wswwnesewnewwneneswsewwwwsewwww
nenenenwnenwnenwnenwenwnewneswnwnwnee
eeweeeeesesewnewseenweseee
enenenewswnenenwseneneeneneenenenenenee
eswenwswnwnwnenewswwneseseseeesenw
swswseswswswswseseswneswsw
neneeenwswnesweswneseneneenenweeenene
newwwwesewsewwwwwwnwswwneww
wesenenwnweseeseseeeeswe
seeeenweneneeneeeeeeene
swwsewnwseseneweneswneeswswnwseswswse
wnenenwswneenewneswneneneeeswenwne
sewnesenwwnwnwnwwnewnwnwnwnwswsewnw
eeeenwswesweeswneeweeeeenee
nwseswswsesesenwseseseswswsw
eeeseseeseesesewnenwewesweweee
wswsewwwsenwnenewsewwsenwnewwnew
eeeeenwneeeenwenesesweeeneeee
nesewseswneneenenwnene
neneenwneneneswsweenewnenwneneenene
nwnwnwnwnwnwwnwnwnwweswnwnwnwnwnwwenw
seswsweseswseswswseneswswwswseseswswsw
seseseswwseseswswswseneenewsew
swsewswswsesesewswseseswswneswnesw
ewweenwneseneeneesweeeweee
swseswswseswsweswneswswswsenwswsw
neseswseseseseseesesenwwseseesesese
nwswnwswnwnwnwwnwenwnwnwenwnwnwnwnenww
neneneneneenesweseenewnewneeswnesee
sweseseeewwneswseenweesesewnwe
nwnwnwnwewnwnwnwnwnwnwwnwwnwwsenwenw
nwwwwswswswwewwsenwww
eswwnwnwneswswswnwwswswweseswwswswsw
swneweseneenenwneneneeseneseweww
nwnenenwnwnenwnenenenwnenwnwnwsenwne
neswswswswswnwsesenenewwseseseswseswse
nesenwswseseseseewsesesweswesenwsesew
nwwnwnwnwnwsenwnweswnwwswnwnwnwnwenenw
nwneneeswnenwnwnenwwnwnwenwneswnwnwsw
nwnenwnwswnenenwnewnwnwnweweswnwswseswe
wnwsenewswnwnwnwnwwnwnwswnwnwswnwenwnwe
swwswswswswswswswswswneseswswswswswswsw
enwesenwseneesewwnwswse
neeneenewenesesweneneeeeneeene
esewesenwnenewneewnenene
nenenenenewneneneneenwnwneneneneneswe
seenweeseeseseesesesee`;



// const INPUT_FILE = 'day24-input.txt';
const DAYS = 100;

/**
 * A hash set that provides proper equivalence semantics for any data type.
 * For an object type, override the toString() method to return a unique, identifying string.
 * Values must be effectively immutable - updates to objects after being stored will NOT be reflected and will result in undefined behavior.
 * @template TValue Type of value to store
 */
class MapSet {
    constructor() {
        /** @type {Map<string, TValue>} */
        this._map = new Map();
    }

    add(value) {
        this._map.set(String(value), value);
    }

    has(value) {
        return this._map.has(String(value));
    }

    delete(value) {
        return this._map.delete(String(value));
    }

    forEach(callback) {
        for (const value of this._map.values()) {
            callback(value, this);
        }
    }

    toArray() {
        return Array.from(this._map.values());
    }

    get size() {
        return this._map.size;
    }
}

/** @typedef {'se'|'sw'|'ne'|'nw'|'e'|'w'} Direction One of the six possible directions away from a tile on a hex grid. */
/** @typedef {Direction[]} Path A list of relative directions that leads from (0,0) to a tile. */
/** @typedef {[number, number]} Coord An (x,y) coordinate pair representing a unique tile. */

/** @type {Path[]} Array of paths to follow */
const input = inputs //require('fs').readFileSync(INPUT_FILE, 'utf-8')
    .split('\n')
    .map(line => Array.from(line.matchAll(/(?:se|sw|ne|nw|e|w)/g)).map(match => match[0]))
;

/** Map of directions to the (x,y) offset that it represents */
const DirectionOffsets = {
    /** @type {[Coord, Coord]} */ ne: [[ -1,  1 ], [ -1,  0 ]],
    /** @type {[Coord, Coord]} */ e:  [[  0,  1 ], [  0,  1 ]],
    /** @type {[Coord, Coord]} */ se: [[  1,  1 ], [  1,  0 ]],
    /** @type {[Coord, Coord]} */ sw: [[  1,  0 ], [  1, -1 ]],
    /** @type {[Coord, Coord]} */ w:  [[  0, -1 ], [  0, -1 ]],
    /** @type {[Coord, Coord]} */ nw: [[ -1,  0 ], [ -1, -1 ]]
};

/** @type {Direction[]} All direction name */
const AllDirections = [ 'ne', 'e', 'se', 'sw', 'w', 'nw' ];

/**
 * Gets the coordinates of all nieghbors of a tile.
 * @param {Coord} coord Coordinate of the tile
 * @returns {Coord[]} Coordinates of all neighbors
 */
function getAllNeighbors(coord) {
    // Select even or odd lookup table
    const evenOdd = Math.abs(coord[0] % 2);
    
    // Cross lookup table with current coordinate to compute all neighbors
    return AllDirections
        .map(dir => DirectionOffsets[dir][evenOdd])
        .map(offset => [ offset[0] + coord[0], offset[1] + coord[1] ]);
}

/**
 * Runs part 1 and returns the coordinates of all flipped tiles.
 * @returns {MapSet<Coord>}
 */
function part1() {
    /** @type {MapSet<Coord>} Coordinates of all tiles that are currently black side up */ 
    const blackTiles = new MapSet();

    // Process each path
    for (const path of input) {
        /** @type {Coord} */
        const coord = [ 0, 0 ];

        // Follow each step of the current path
        for (const dir of path) {
            // Get the offset for the current direction
            const offset = DirectionOffsets[dir][Math.abs(coord[0] % 2)];

            // Apply offset
            coord[0] += offset[0];
            coord[1] += offset[1];
        }

        // Flip the tile
        if (blackTiles.has(coord)) {
            // Flip black -> white
            blackTiles.delete(coord);
    
        } else {
            // Flip white -> black
            blackTiles.add(coord);
        }
    }

    return blackTiles;
}

/**
 * Runs part 2 and returns the coordinates of all flipped tiles.
 * @param {MapSet<Coord>} initialState 
 * @returns {MapSet<Coord>}
 */
function part2(initialState) {
    // simulate each day
    for (let day = 0; day < DAYS; day++) {
        // Identify all coordinates that are "in scope" for this day
        const inScope = new MapSet();
        initialState.forEach(coord => {
            // Every flipped tile is in scope
            inScope.add(coord);
            // Neighbors of flipped states are in scope
            getAllNeighbors(coord).forEach(adjacent => inScope.add(adjacent));
        });

        // Compute the next state
        const newState = new MapSet();
        inScope.forEach(coord => {
            // Count flipped neighbors of this tile
            const adjacentCount = getAllNeighbors(coord).reduce((count, adjacent) =>
                initialState.has(adjacent) ? (count + 1) : count
            , 0);

            if (initialState.has(coord)) {
                if (adjacentCount === 1 || adjacentCount === 2) {
                    // If tile is flipped and has 1 or 2 flipped neighbors, then keep flipped
                    newState.add(coord);
                }
            } else {
                if (adjacentCount === 2) {
                    // If tile is NOT flipped but has 2 neighbors, then flip
                    newState.add(coord);
                }
            }
        });

        // switch to new state
        initialState = newState;
    }

    return initialState;
}

// Part 1
const part1Flipped = part1();
console.log(`Part 1: There are ${ part1Flipped.size } flipped tiles.`);

// Part 2
const part2Flipped = part2(part1Flipped);
console.log(`Part 2: There are ${ part2Flipped.size } flipped tiles.`);
